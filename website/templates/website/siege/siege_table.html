{% load static %}
{% load other %}
{% load monsters %}


{% load static %}
{% load other %}
{% load monsters %}

<div class='comparison-table'>
    <table class="table table-dark table-striped table-bordered table-hover" id='table-siege' style='width: 100%;'>
        <thead>
            <tr>
                <th scope="col">Monsters</th>
                <th scope="col">Leader</th>
                <th scope="col">Wins</th>
                <th scope="col">Loses</th>
                <th scope="col">Win Rate</th>
                <th scope="col">Rank</th>
                <th scope="col">Points</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
                {% if record.full %}
                    <tr>
                        <td>
                            {% with record.monsters.all as monsters %}
                                {% for monster in monsters %}
                                    {% with monster.id|randomize as rand_mon_id %}
                                        <a href="{% url 'monster_by_id' arg_id=monster.id %}" class="table-monster-href">
                                            <img src="{% static 'website/images/monsters/'|get_monster_avatar:monster %}" class="table-monster-avatar tip" data-tip="mon-{{ rand_mon_id }}" onmouseenter="ajaxTooltip({{ monster.id }}, 'mon', '{{ rand_mon_id }}', this, '{% url 'object_card' obj_type='mon' obj_id=monster.id %}')" onmouseleave="ajaxTooltipLeave(this)" />
                                        </a>
                                        <div id="mon-{{ rand_mon_id }}" class="tip-content" style='display: none;'>
                                            <div class='card-custom disclaimer'>
                                                <div class='card-custom-header'>
                                                    Loading...
                                                </div>
                                                <div class='card-custom-body'>
                                                    Loading...
                                                </div>
                                            </div>
                                        </div>
                                    {% endwith %}
                                {% endfor %}
                            {% endwith %}
                        </td>
                        <td>
                            {% with record.leader.id|randomize as rand_mon_id %}
                                <a href="{% url 'monster_by_id' arg_id=record.leader.id %}">
                                    <img src="{% static 'website/images/monsters/'|get_monster_avatar:record.leader %}" class="table-monster-avatar tip" data-tip="mon-{{ rand_mon_id }}" onmouseenter="ajaxTooltip({{ record.leader.id }}, 'mon', '{{ rand_mon_id }}', this, '{% url 'object_card' obj_type='mon' obj_id=record.leader.id %}')" onmouseleave="ajaxTooltipLeave(this)" />
                                </a>
                                <div id="mon-{{ rand_mon_id }}" class="tip-content" style='display: none;'>
                                    <div class='card-custom disclaimer'>
                                        <div class='card-custom-header'>
                                            Loading...
                                        </div>
                                        <div class='card-custom-body'>
                                            Loading...
                                        </div>
                                    </div>
                                </div>
                            {% endwith %}
                        </td>
                        <td>{{ record.win }}</td>
                        <td>{{ record.lose }}</td>
                        <td>{{ record.ratio|add_str:"%" }}</td>
                        <td>{{ record.wizard.guild.get_siege_ranking_display|default:"No information given" }}</td>
                        <td>{{ record.sorting_val|floatformat:"-4" }}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
<script src="{% static 'website/js/tooltip.js' %}" />
<script>
    $('#table-siege').DataTable({
        scrollY: window.innerHeight - 200,
        scrollX: true,
        scrollCollapse: true,
        tooltip: true,
        responsive: true,
        "order": [[ 5, "desc" ]],
        "drawCallback": function( settings ) {
            initTableTooltips(); // your tootlip function.
        },
    });
</script>