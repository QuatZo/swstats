{% extends "website/base.html" %}
{% load static %}
{% load add_str %}

{% block content_title %}
    Report Generator
{% endblock %}

{% block content %} 
    <div class="row">
        {% for mon in counts %}
                <div class="col-3 col-sm-1">{{ mon.base_monster__name }}</div>
                <div class="col-3 col-sm-1">{{ mon.equipped }} / {{ mon.total }}</div>
        {% endfor %}
    </div>

    <form method="POST" id="report-upload" class="form-group">
        {% csrf_token %}
        <label for="base-monster">Select Monster</label>
        <select name="base-monster" id="base-monster" class="form-control">
            {% for monster in base_monsters %}
                <option value="{{ monster.id }}">{{ monster }}
            {% endfor %}
        </select>
        <br />
        <input type="submit" value="Generate Report" class="btn btn-secondary btn-block">
    </form>
    <div id='report-generator'>
        {% csrf_token %}
    </div>
{% endblock %}

{% block jquery %}
<script src="{% static 'website/js/table2csv.js' %}"></script>
<script>
    var url = "/api/reportgenerator/"
    $("#report-upload").submit(function(e) {
        e.preventDefault();
        $('#report-generator').text("Generating report, please wait...");
        $.ajax({
            type: "POST",
            url: url,
            contentType: 'application/json',
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            data: $('#base-monster').val(),
            success: function(data) {
                $('#report-generator').html(data);
            },
            error: function(){
                $('#report-generator').html("<h2>Something went wrong. Check Server Logs.</h2>");
            }
        });
    });
</script>
{% endblock %}