{% extends "website/base.html" %}
{% load static %}
{% load add_str %}

{% block custom_script %}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'website/css/datatable.min.css' %}" media="screen">
    <link rel="stylesheet" type="text/css" href="{% static 'website/css/datatable-bootstrap.min.css' %}" media="screen">
    <script type="text/javascript" src="{% static 'website/js/datatable.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'website/js/datatable.jquery.min.js' %}"></script>
{% endblock %}

{% block content_title %}
    Report Generator
{% endblock %}

{% block ajax_container %} 
    <form method="POST" id="report-upload" class="form-group">
        {% csrf_token %}
        <label for="base-monster">Select Monster</label>
        <select name="base-monster" id="base-monster" class="form-control">
            {% for el in base %}
                <option value="{{ el.id }}">{{ el.name }} ({{ el.count }})
            {% endfor %}
        </select>
        <br />
        <input type="submit" value="Generate Report" class="btn btn-secondary btn-block">
    </form>
    <div id='report-generator'>
        {% csrf_token %}
    </div>
{% endblock %}

{% block jquery %}
<script src="{% static 'website/js/table2csv.js' %}"></script>
<script>
    var url = "/api/reportgenerator/"
    $("#report-upload").submit(function(e) {
        e.preventDefault();
        $('#report-generator').text("Generating report, please wait...");
        $.ajax({
            type: "POST",
            url: url,
            contentType: 'application/json',
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            data: $('#base-monster').val(),
            success: function(data) {
                $('#report-generator').html(data);
            },
            error: function(){
                $('#report-generator').html("<h2>There was an error while connecting. Please, try again.<br>If error still exists, contact <a href='http://reddit.com/u/quatzo'>administrator</a>.");
            }
        });
    });
</script>
{% endblock %}