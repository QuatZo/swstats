{% extends "website/base.html" %}
{% load static %}
{% load add_str %}

{% block custom_script %}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.flash.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.6.2/js/buttons.print.min.js"></script> 
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">
{% endblock %}

{% block content_title %}
    Report Generator
{% endblock %}

{% block ajax_container %} 
    <form method="POST" id="report-upload" class="form-group">
        {% csrf_token %}
        <label for="base-monster">Select Monster</label>
        <select name="base-monster" id="base-monster" class="form-control">
            {% for el in base %}
                <option value="{{ el.id }}">{{ el.name }} ({{ el.count }})
            {% endfor %}
        </select>
        <br />
        <input type="submit" value="Generate Report" class="btn btn-secondary btn-block">
    </form>
    <div id='report-generator'>
        {% csrf_token %}
    </div>
{% endblock %}

{% block jquery %}
<script src="{% static 'website/js/table2csv.js' %}"></script>
<script>
    var url = "/api/reportgenerator/"
    $("#report-upload").submit(function(e) {
        e.preventDefault();
        $('#report-generator').html("<div class='loader'>Loading...</div></div>");
        $.ajax({
            type: "POST",
            url: url,
            contentType: 'application/json',
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            data: $('#base-monster').val(),
            success: function(data) {
                $('#report-generator').html(data);
            },
            error: function(){
                $('#report-generator').html("<h2>There was an error while connecting. Please, try again.<br>If error still exists, contact <a href='http://reddit.com/u/quatzo'>administrator</a>.");
            }
        });
    });
</script>
{% endblock %}