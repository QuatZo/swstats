{% extends "website/base.html" %}

{% block custom_script %}
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
	<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.21/fh-3.1.7/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.21/fh-3.1.7/datatables.min.js"></script>
{% endblock %}

{% block content_title %}
	{{ name }}
{% endblock %}

{% block jquery %}
    <script>
        function fetchData(){
            $.ajax({
                url: "{% url 'rift_dungeon_by_stage_ajax' task_id=task_id name=name %}",
                type: "GET",
                success: function(response) {
                    seconds += .5;
                    $('#secs').text(seconds);
                    if(response){
                        $('#content-ajax-container').html(response);
                        MathJax.typesetPromise();
                    }
                    else if (seconds == 60){
                        $('#content-ajax-container').html("{% include 'website/error_timeout.html' with task_id=task_id %}");
                    }
                    else{
                        setTimeout(fetchData, 500);
                    }
                },
                error: function(xhr) {
                    $('#content-ajax-container').html("{% include 'website/error.html' with task_id=task_id %}");
                }
            });
        }
        var seconds = 0;
        fetchData();
    </script>
{% endblock %}